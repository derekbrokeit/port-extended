#!/bin/bash
# pup
#--------------------
## Licence
# Copyright 2011 Derek Ashley Thomas
# This file is part of port-extended.
#
# port-extended is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# port-extended is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with port-extended.  If not, see <http://www.gnu.org/licenses/>.
#--------------------

# output file
PUP_FILE="$HOME/.port.updated"

# updated desired, so remove the latest update file
rm -f $PUP_FILE* &> /dev/null 

# attempt to run in a tmux server
if [[ -x tmwin ]] ; then
    tmwin portupdate 'sudo hili portupdate'" $PUP_FILE" 
else
    portupdate 'sudo hili portupdate'" $PUP_FILE" 
fi

if [[ -e ${PUP_FILE}.exit ]] ; then
  #update completed successfully

  #port installed | awk '{print $1}' | sed '1d' | tr '[:upper:]' '[:lower:]' | uniq  > $LOGS_DIR/port
  #port installed active | sed '1d' | awk '{ print $1,$2}'  > $LOGS_DIR/port
  port installed active | sed '1d' | awk '{ print $1,$2}' | tr '[:upper:]' '[:lower:]' > $LOGS_DIR/port

  rm -f ${PUP_FILE}.exit &> /dev/null
fi 

